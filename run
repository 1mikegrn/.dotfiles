NVIM=$(which nvim)

_install_appimage() {
    pushd $HOME
    [ -d ./Applications ] && mkdir Applications
    cd Applications
    wget https://github.com/neovim/neovim/releases/download/v0.7.0/nvim.appimage -O nvim
    [ -z "${NVIM}" ] && NVIM="~/Applications/nvim"
    chmod +x $NVIM
    popd
}

install() {
    if [ $2 = "deps" ]
    then
        if [ -x "$(command -v pacman)" ]
        then
            sudo pacman -Sy stow the_silver_searcher neovim fd ripgrep fzf
        elif [ -x "$(command -v apt-get)" ]
        then
            _install_appimage
            sudo apt-get install stow silversearcher-ag fd-find ripgrep fzf
        fi
        python -m pip install pynvim
        git submodule update
    fi
    pushd ~/.dotfiles

    for folder in $(ls -d */ | sed "s/,/ /g")
    do
        stow $folder
    done
    ~/.fzf/install
    $NVIM --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
    popd
}

remove() {
        pushd ~/.dotfiles
        for folder in $(ls -d */ | sed "s/,/ /g")
        do
            stow -D $folder
        done
        ~/.fzf/uninstall
        popd
}

reinstall() {
    remove
    install
}

case $1 in
    "install") install $@ ;;
    "remove") remove $@ ;;
    "reinstall") reinstall $@ ;;
    "_install_appimage") _install_appimage $@ ;;
esac
